<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
   <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
   
    <style>
        textarea{height:400px !important}
    </style>
</head>
<body>
   
    <!-- Image and text -->
<nav class="navbar navbar-dark bg-dark">
  <a class="navbar-brand" href="#">
    TableToPanel
  </a>
</nav>
    
    <form>        

        <div class="container-fluid">
            

            <p>&nbsp;</p>

            <div class="row">
                <div class="col-lg-12">
                    <div class="alert alert-warning text-center" id="divMensaje"></div>
                </div>
            </div>

            <p><br />Convert a table into a Bootstrap panel</p>
            <p>&nbsp;</p>
            
             <div class="row">
                <div class="col-lg-12 text-center">
                    <input type="button" id="btnTrasformar" value="Convert" class="btn btn-primary" />
                    <input type="reset" id="btnResetear" value ="Reset" class="btn btn-dark" />                   
                </div>
            </div>

            <p>&nbsp</p>

            <div class="row">
                <div class="col-lg-6">                   
                    <textarea id="txtOrigen" class="form-control" cols="60" placeholder="insert html table code"></textarea>
                </div>

                <div class="col-lg-6">                    
                    <textarea id="txtDestino" class="form-control" cols="60"></textarea>
                </div>
            </div>

           
        </div>
     </form>        

    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyAn35o5UVeGi1H1Q7LAWRiTBoQSNMXN8Mc",
    authDomain: "tabletopanel-d064d.firebaseapp.com",
    databaseURL: "https://tabletopanel-d064d.firebaseio.com",
    projectId: "tabletopanel-d064d",
    storageBucket: "tabletopanel-d064d.appspot.com",
    messagingSenderId: "201426492120"
  };
  firebase.initializeApp(config);
</script>

    
    <script
  src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.0.1/mustache.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.9.0/beautify-html.js"></script>


    <script type="text/javascript">

       
        $("#btnTrasformar").click(function () {

            var heading = "";
            var body = "";
            var footer = "";
            var col = 12;
           
            var plantillas = ["<div class=\"panel panel-default\"><div class=\"panel-heading\">{{{heading}}}</div><div class=\"panel-body\">{{{body}}}</div><div class=\"panel-footer\">{{{footer}}}</div></div>",
                "<div class=\"col-lg-{{{col}}} col-md-{{{col}}} col-sm-12 col-xs-12\"><div class=\"form-group\">{{{contenido}}}</div></div>",
                "<label>{{{etiqueta}}}</label>"];
            

             
           
            var htmlOrigenBeautify = html_beautify($("#txtOrigen").val());
            $("#txtOrigen").val(htmlOrigenBeautify)

            var $contenido = $(htmlOrigenBeautify);
            var boolHayTitulo = false;
            var boolHayBotones = false;
            var boolCrearPanel = false;
            var strMensaje = "";
            
            var $filas = $contenido.find("tr");
            var intIndexUltimaFila = $filas.length - 1;

            var vl_ContenidoFormulario = "";
            var vl_strTitulo = "";
            var vl_strBotonera = "";

            var vistaPanel = {"heading": "","body":"","footer":""};

            $filas.each(function (index,elemento) {

                 if (index == 0) {
                     boolHayTitulo = ($(this).find("td").length == 1 || $(this).find("th").length == 1) ? true : false;
                     if (boolHayTitulo) vl_strTitulo = $(this).text().trim();                     
                } else if (index == intIndexUltimaFila) {
                     boolHayBotones = ($(this).find("button")) ? true : false;                         
                     if (boolHayBotones) {
                         vl_strBotonera = $(this).find("td").html();
                     }



                 } else {

                     var anchoColumna = Math.ceil(12 / $(this).find("td").length);
                    if ($(this).find("td").length % 2 == 0) {
                        var intCrearElementos = ($(this).find("td").length / 2);
                        vl_ContenidoFormulario+= CrearElementos(intCrearElementos, $(this).find("td"),plantillas[1],anchoColumna);
                    } else {
                        strMensaje += "Fila :" + index + " Mal Formada<br>";
                    }                   
                }

            });

            //Mostramos los posibles errores
            if (strMensaje === "")
                strMensaje = "Generación Correcta :)";
            $("#divMensaje").text(strMensaje);

            if (boolHayTitulo && boolHayBotones) {

                vistaPanel.heading = vl_strTitulo;
                vistaPanel.body = vl_ContenidoFormulario;
                vistaPanel.footer = vl_strBotonera;

                $("#txtDestino").val(html_beautify(Mustache.render(plantillas[0], vistaPanel)));

            } else {
                //pegamos la salida
                $("#txtDestino").val(vl_ContenidoFormulario);
            }

            //Lo copiamos al portapapeles
            var codigoGenerado = document.getElementById("txtDestino");
            codigoGenerado.select();
            document.execCommand("copy");


            function CrearElementos(pe_intCrearElementos, pe_Elemento,pe_plantillaMustache,anchoColumna) {

                var vl_strSalida = "";
                var vista={col:3,"contenido":""}
                var vistaEtiqueta = { "etiqueta": "" };

                var vl_snippet = "";
                var vl_indiceElemento = -1;

                $(pe_Elemento).each(function (indice, elemento) {
                    
                    var contenido = ($(elemento)[0].innerHTML);
                    
                    if (indice % 2 == 0) {
                       // console.log("Indice=" + indice + " es Etiqueta " + contenido);                                 
                        if (!TieneTaglabel(contenido)) {
                            vistaEtiqueta.etiqueta = contenido;
                            //vista.contenido+= Mustache.render(plantillas[2],vistaEtiqueta);
                            vl_snippet = Mustache.render(plantillas[2],vistaEtiqueta);
                        } else {
                            //vista.contenido += contenido + " ";
                            vl_snippet = contenido + " ";
                        }

                        vl_indiceElemento++;
                       
                    } else {
                       // console.log("Indice=" + indice + " es Control " + contenido);                           

                        if (TieneClaseCss(contenido)) {
                            vl_snippet+= ReemplazarClase(contenido, "form-control")+ " ";
                        } else {
                            vl_snippet+= AnadirCssClase(contenido, "form-control")+ " ";
                        }                        
                        vl_indiceElemento++;
                    }

                    if (vl_indiceElemento == 1) {
                        vista.contenido = vl_snippet;
                        vl_strSalida += Mustache.render(pe_plantillaMustache, vista);
                        vl_indiceElemento = -1;
                    }

                });

                
                //vista.contenido+= etiqueta + " " + control;
                //return Mustache.render(pe_plantillaMustache,vista)
                return vl_strSalida;

            }

            function TieneTaglabel(pe_elemento) {

                return (pe_elemento.toLowerCase().indexOf("label")==-1)?false:true;
            }

            function TieneClaseCss(pe_elemento) {

                var vl_boolSalida = false;
                if (pe_elemento.indexOf("class") != -1 || pe_elemento.indexOf("CssClass")!=-1){
                    vl_boolSalida = true;
                }

                return vl_boolSalida;
            }

            function ReemplazarClase(pe_elemento,pe_nuevoValor) {
                
                var vl_strSalida = "";

                if (pe_elemento.search(/(asp:|telerick:|daypilot:|ajaxToolKit:)/) != -1) {
                    vl_strSalida = pe_elemento.replace(/ClassCss=\"(.+)\"/i,"ClassCss='"+pe_nuevoValor+"'");
                } else {
                    vl_strSalida = pe_elemento.replace(/class=\"(.+)\"/i,"class='"+pe_nuevoValor+"'");
                }

                return vl_strSalida;

            }

            function AnadirCssClase(pe_elemento, pe_nombreClase) {

                //Puede ser una etiqueta html o u webControl
                var propiedadCss = "CssClass=\""+pe_nombreClase+"\"";
                if (pe_elemento.search(/(asp:|telerick:|daypilot:|ajaxToolKit:)/)==-1) {
                    propiedadCss = "class=\""+pe_nombreClase+"\"";
                }

                var posicion = pe_elemento.indexOf("/>");
                if (posicion == -1) {
                    posicion = pe_elemento.indexOf(">");
                }

                return [pe_elemento.slice(0, posicion), propiedadCss, pe_elemento.slice(posicion)].join('');

            }

        });



    </script>
</body>
</html>
